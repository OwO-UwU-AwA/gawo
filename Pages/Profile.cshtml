@page
@model ProfileModel
@{
  ViewData["Title"] = $"Gaußwoche {DateTime.Now.Year}";
}

<h2>@Model.UserStruct!.FirstName @Model.UserStruct.LastName</h2>
<hr class="border border-primary opacity-50">

Klasse: @Model.UserStruct.Class <br>
E-Mail-Adresse: @Model.UserStruct.Email <br>
Rolle:
@{
  if ((Model.UserStruct.Permissions & (1 << 0)) != 0)
  {
    @: Administrator
  }
  else if ((Model.UserStruct.Permissions & (1 << 1)) != 0)
  {
    @: Lehrer
  }
  else if ((Model.UserStruct.Permissions & (1 << 2)) != 0)
  {
    @: Gast
  }
  else
  {
    @: Schüler
  }
} <br>


@if (Model.UserStruct.Absence != 0)
{
  string[] days = { "Montag", "Dienstag", "Mittwoch", "Donnerstag", "Freitag" };
  string[] absent = { "", "", "", "", "" };

  @: Abgemeldet für :

  // TODO: Clean Up This Mess
  if ((Model.UserStruct.Absence & (1 << 0)) != 0)
  {
    absent[0] = "Montag";
  }
  if ((Model.UserStruct.Absence & (1 << 1)) != 0)
  {
    absent[1] = "Dienstag";
  }
  if ((Model.UserStruct.Absence & (1 << 2)) != 0)
  {
    absent[2] = "Mittwoch";
  }
  if ((Model.UserStruct.Absence & (1 << 3)) != 0)
  {
    absent[3] = "Donnerstag";
  }
  if ((Model.UserStruct.Absence & (1 << 4)) != 0)
  {
    absent[4] = "Freitag";
  }

  // Remove all days not absent
  absent = absent.Where(x => !string.IsNullOrEmpty(x)).ToArray();

  // for every day absent: add a comma after it and print it except for the last day which does not have a comma following
  for (int i = 0; i < absent.Length; i++)
  {
    if (i != absent.Length - 1)
    {
      absent[i] += ", ";
    }
    @absent[i]
  }
}

<div class="content text-wrap" style="display: flex; flex-direction: row; align-items: baseline;">

  <form method="post" asp-page-handler="ChangePassword" style="margin-top: 5%; margin-bottom: 5%; margin-right: 2%;">
    <div class="form-group" style="margin-bottom: 5%; display: flex; flex-direction: column;">
      <label asp-for="CurrentPassword">Derzeitiges Passwort</label>
      <input type="password" class="form-control" id="currentpassword" name="currentpassword" required>
    </div>
    <div class="form-group" style="margin-bottom: 5%; display: flex; flex-direction: column;">
      <label asp-for="NewPassword">Neues Passwort</label>
      <input type="password" class="form-control" id="newpassword" name="newpassword" required>
    </div>
    <div class="form-group" style="margin-bottom: 5%; display: flex; flex-direction: column;">
      <label asp-for="NewPasswordConf">Neues Passwort Bestätigen</label>
      <input type="password" class="form-control" id="newpasswordconf" name="newpasswordconf" required>
      <button type="submit" class="btn btn-success" style="margin-top: 5%;">Passwort Ändern</button>
    </div>
  </form>

  <form method="post" asp-page-handler="ChangeEmail">
    <div class="form-group" style="margin-bottom: 5%; display: flex; flex-direction: column;">
      <label asp-for="CurrentEmail">Derzeitige E-Mail-Adresse</label>
      <input type="email" class="form-control" id="currentemail" name="currentemail" required>
    </div>
    <div class="form-group" style="margin-bottom: 5%; display: flex; flex-direction: column;">
      <label asp-for="NewEmail">Neue E-Mail-Adresse</label>
      <input type="email" class="form-control" id="newemail" name="newemail" required>
    </div>
      <button type="submit" class="btn btn-success" style="margin-top: 10%; width: 100%;">Email Ändern</button>
  </form>

<style>
    .checkbox-group {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75em;
        justify-content: space-between;
        max-width: 400px; /* Adjust the maximum width as needed */
    }

    .checkbox-item {
        display: flex;
        align-items: center;
    }

    .checkbox-item label {
        width: 110px; /* Adjust the width as needed */
    }
</style>

<form asp-page-handler="ChangeAbsence" method="post" id="absentForm" style="margin-top: 5%; margin-bottom: 5%; margin-left: 2%;">
    <div class="checkbox-group">
        <div class="checkbox-item">
            <label asp-for="Monday" for="monday">Montag</label>
            <input value="1" type="checkbox" class="form-check-input" id="monday" name="monday">
        </div>

        <div class="checkbox-item">
            <label asp-for="Tuesday" for="tuesday">Dienstag</label>
            <input value="2" type="checkbox" class="form-check-input" id="tuesday" name="tuesday">
        </div>

        <div class="checkbox-item">
            <label asp-for="Wednesday" for="wednesday">Mittwoch</label>
            <input value="3" type="checkbox" class="form-check-input" id="wednesday" name="wednesday">
        </div>

        <div class="checkbox-item">
            <label asp-for="Thursday" for="thursday">Donnerstag</label>
            <input value="4" type="checkbox" class="form-check-input" id="thursday" name="thursday">
        </div>

        <div class="checkbox-item">
            <label asp-for="Friday" for="friday">Freitag</label>
            <input value="5" type="checkbox" class="form-check-input" id="friday" name="friday">
        </div>
    </div>
    <button type="submit" class="btn btn-success" style="margin-top: 10%; width: 100%;">Speichern</button>
</form>





<h3 class="text-danger">@Model.ValidationErrorMessage</h3>
</div>